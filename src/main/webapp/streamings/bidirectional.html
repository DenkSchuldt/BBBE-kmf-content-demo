<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Bidirectional Streaming Demo</title>
        <link rel="stylesheet" type="text/css" href="../css/style.css"/>
        <!--<script src="../js/kws-content-api.js"></script>
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">-->
        <script src="../lib/adapter.js"></script>
        <script src="../lib/Console.js"></script>
        <script>
            
            var conn, 
                conn_2,
                handler,
                controller = true;

            window.onload = function() {
                console = new Console("console", console);
            };
            
            function initConnection(conn,handler) {
                console.log("Creating connection to " + handler);
                conn.on("start", function(event) {
                    console.log("Connection started");
                });
                conn.on("terminate", function(event) {
                    console.log("Connection terminated");
                });
                conn.on("localstream", function(event) {
                    console.info("LocalStream set");
                });
                conn.on("remotestream", function(event) {
                    console.info("RemoteStream set");
                });
                conn.on("mediaevent", function(event) {
                    console.info("MediaEvent: " + JSON.stringify(event.data));
                });
                conn.on("error", function(error) {
                    console.error(error.message);
                });
            }

            function start() {
                if(controller){
                    var selfVideo = document.getElementById("self-video");		
                    selfVideo.style.background = "white center url('../img/spinner.gif') no-repeat";
                    var selfRemote = document.getElementById("self-remote");
                    selfRemote.style.background = "white center url('../img/spinner.gif') no-repeat";
                    handler = "../bidirectional";
                    var options = {
                        localVideoTag: "self-video",
                        remoteVideoTag: "self-remote",
                        audio: "sendonly"
                    };
                    try {
                        conn = new kwsContentApi.KwsWebRtcContent(handler, options);
                        initConnection(conn, handler);
                        controller = false;
                        document.getElementById("#start").innerHTML = "New Connection";
                    }
                    catch(error) {
                        console.error(error.message);
                    }
                }else{
                    var remoteRemote = document.getElementById("remote-remote");
                    remoteRemote.style.background = "white center url('../img/spinner.gif') no-repeat";
                    var option = { 
                        remoteVideoTag: "remote-remote",
                        audio: "recvonly",
                        video: "recvonly"
                    };
                    try {
                        conn_2 = new kwsContentApi.KwsWebRtcContent(handler, option);
                        initConnection(conn_2);
                        $("#start").prop('disabled', true);
                    }
                    catch(error) {
                        console.error(error.message);
                    }
                }
            }
            
            function terminate() {
                if (!conn) {
                    alert("No connection to terminate.");
                    return false;
                }
                conn.terminate();
                location.reload();
            }
        </script>
    </head>
    <body>
        <header><a href="../index.html" style="text-decoration: none; color: white;"><i class="fa fa-arrow-circle-o-left"></i> Bidirectional Streaming Demo</a></header>
        <section>
            <article>
                <video id="self-video" autoplay controls></video>
                <div id="video-divs">
                    <video id="self-remote" autoplay controls></video>
                    <video id="remote-remote" autoplay controls></video>
                </div>
                <button id="start" onclick="start()">Start</button>
                <button id="terminate" onclick="terminate()">Terminate</button>
            </article>
        </section>
        <footer>BigBlueButton Ecuador 2014</footer>
        <div id="console"></div>
    </body>
</html>
