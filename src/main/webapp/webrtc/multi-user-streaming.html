<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Multi User streaming Demo</title>
        <script src="../lib/kws-content-api.js"></script>
        <link rel="stylesheet" type="text/css" href="../css/style.css"/>
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
        <script src="../lib/adapter.js"></script>
        <script src="../lib/Console.js"></script>
        <script>
            
            var conn, conn_2;
            var urls = new Array();
            var handler;
            var controller = true;

            window.onload = function() {
                console = new Console("console", console);
            };

            function terminate() {
                conn.terminate();
                location.reload();
            }

            function initConnection(conn) {
                console.log("Creating connection to " + handler);
                conn.on("start", function(event) {
                });
                conn.on("terminate", function(event) {
                });
                conn.on("localstream", function(event) {
                    console.info("\n\nLocalStream set");
                    console.log("--------LOCAL SET!---------\n\n");
                    /*var remote = document.createElement("video");
                    $(remote).attr('autoplay','');
                    $(remote).attr('controls','');
                    $(remote).css("background","white center url('../img/spinner.gif') no-repeat");
                    $(remote).css("width","25%");
                    $(remote).css("margin","2%");
                    document.getElementById("videos").appendChild(remote);*/
                });
                conn.on("remotestream", function(event) {
                    console.info("\n\nRemoteStream set:");
                    $("#videos video").click(function(){
                        var src1 = $("#oneLocal").attr("src");
                        var src2 = $(this).attr("src");
                        $("#oneLocal").attr("src",src2);
                        $(this).attr("src",src1);
                    });
                    console.log("--------REMOTE SET!---------\n\n");
                });
                conn.on("mediaevent", function(event) {
                    console.info("MediaEvent: " + JSON.stringify(event.data));
                });
                conn.on("error", function(error) {
                    console.error(error.message);
                });
            }

            function start() {
                if(controller){
                    var oneLocal = document.getElementById("oneLocal");		
                    oneLocal.style.background = "white center url('../img/spinner.gif') no-repeat";
                    oneLocal.style.width ="50%"
                    var oneRemote = document.getElementById("oneRemote");
                    oneRemote.style.background = "white center url('../img/spinner.gif') no-repeat";
                    oneRemote.style.width ="25%"
                    handler = "../multiUserStreaming"
                    var options = {
                        localVideoTag: "oneLocal",
                        remoteVideoTag: "oneRemote"
                    };
                    try {
                        conn = new kwsContentApi.KwsWebRtcContent(handler, options);
                        initConnection(conn);
                        controller = false;
                        $("#start").html("New Connection");
                    }
                    catch(error) {
                        console.error(error.message);
                    }
                }else{
                    var twoRemote = document.getElementById("twoRemote");
                    twoRemote.style.background = "white center url('../img/spinner.gif') no-repeat";
                    twoRemote.style.width ="25%"
                    var option = { remoteVideoTag: "twoRemote" };
                    try {
                        conn_2 = new kwsContentApi.KwsWebRtcContent(handler, option);
                        initConnection(conn_2);
                        $("#start").prop('disabled', true);
                    }
                    catch(error) {
                        console.error(error.message);
                    }
                }
            }
        </script>
    </head>
    <body>
        <header class="header"><a href="../index.html" style="text-decoration: none; color: white;"><i class="fa fa-arrow-circle-o-left"></i> Multi User Streaming</a></header>
        <section class="streaming-section">
            <article class="streaming-article">
                <video class="principal" id="oneLocal" autoplay controls></video>
                <div id="videos">
                    <video id="oneRemote" autoplay controls></video>
                    <video id="twoRemote" autoplay controls></video>
                </div>
                <button id="start" onclick="start()">Start</button>
                <button id="terminate" onclick="terminate()">Terminate</button>
            </article>
        </section>
        <footer>BigBlueButton Ecuador 2014</footer>
        <div id="console"></div>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    </body>
</html>
