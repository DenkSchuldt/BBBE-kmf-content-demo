<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Multi User streaming Demo</title>
        <script src="../lib/kws-content-api.js"></script>
        <link rel="stylesheet" type="text/css" href="../css/style.css"/>
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
        <script src="../lib/adapter.js"></script>
        <script src="../lib/Console.js"></script>
        <script>
            
            var conn;
            var remotes = new Array();
            var connections = new Array();
            var handler;
            var controller = 0;
            var cont = 0;

            window.onload = function() {
                console = new Console("console", console);
            }

            function terminate() {
                conn.terminate();
                location.reload();
            }

            function initConnection(conn) {
                console.log("Creating connection to " + handler);
                conn.on("start", function(event) {
                    console.log("\n\nConnection started");
                });
                conn.on("terminate", function(event) {
                    console.log("Connection terminated");
                });
                conn.on("localstream", function(event) {
                    console.info("\n\nLocalStream set");
                    console.info("Este es el contenido del event:");
                    console.log(event);
                    var remote = document.createElement("video");
                    $(remote).attr("id","remote"+cont);
                    $(remote).attr('autoplay','');
                    $(remote).attr('controls','');
                    $(remote).css("background","white center url('../img/spinner.gif') no-repeat");
                    $(remote).css("width","25%");
                    $(remote).css("margin","2%");
                    cont++;
                    document.getElementById("videos").appendChild(remote);
                    remotes[remotes.length] = remote;
                });
                conn.on("remotestream", function(event) {
                    console.info("\n\nRemoteStream set:");
                    console.info("Este es el contenido del event:");
                    console.log(event);
                });
                conn.on("mediaevent", function(event) {
                    console.info("MediaEvent: " + JSON.stringify(event.data));
                });
                conn.on("error", function(error) {
                    console.error(error.message);
                });
            }

            function start() {
		var localVideo = document.getElementById("localVideo");		
                localVideo.style.background = "white center url('../img/spinner.gif') no-repeat";
                localVideo.style.width ="50%"
		handler = "../multiUserStreaming"
                var id = "remote"+cont;
		var options = {
                    localVideoTag: "localVideo",
                    remoteVideoTag: id
                };
		try {
                    conn = new kwsContentApi.KwsWebRtcContent(handler, options);
                    connections[connections.length] = conn;
                    initConnection(conn);
		}
		catch(error) {
                    console.error(error.message);
		}
            }
        </script>
    </head>
    <body>
        <header class="header"><a href="../index.html" style="text-decoration: none; color: white;"><i class="fa fa-arrow-circle-o-left"></i> Multi User Streaming</a></header>
        <section class="streaming-section">
            <article class="streaming-article">
                <video id="localVideo" autoplay controls></video>
                <div id="videos">
                </div>
                <button id="start" onclick="start()">Start</button>
                <button id="terminate" onclick="terminate()">Terminate</button>
            </article>
        </section>
        <footer>BigBlueButton Ecuador 2014</footer>
        <div id="console"></div>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    </body>
</html>
